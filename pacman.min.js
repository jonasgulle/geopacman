const gameWidth=1080,gameHeight=1920;var gameStarted=!1,noSleep=new NoSleep;function calculateDistance(q,s,u,v){var z=(u-q).toRad(),A=(v-s).toRad(),B=Math.sin(z/2)*Math.sin(z/2)+Math.cos(q.toRad())*Math.cos(u.toRad())*Math.sin(A/2)*Math.sin(A/2),C=2*Math.atan2(Math.sqrt(B),Math.sqrt(1-B));return 6371000*C}Number.prototype.toRad=function(){return this*Math.PI/180};function lerp(q,s,u){return q*(1-u)+s*u}function calculateSnapGrid(){var q={x:37,y:861,lat:62.389415,lon:17.301815},s={x:1053,y:861,lat:62.391632,lon:17.302909},u={x:37,y:1279,lat:62.389211,lon:17.303724},v={x:1053,y:1279,lat:62.391394,lon:17.304851},w={x:37,y:1605,lat:62.389052,lon:17.305226},z={x:1053,y:1605,lat:62.39123,lon:17.306374},A={x:269,y:593,lat:62.390056,lon:17.30087},B={x:269,y:1891,lat:62.38945,lon:17.306793},C={x:514,y:593,lat:62.390573,lon:17.301106},D={x:514,y:1891,lat:62.389917,lon:17.307104},E={x:731,y:593,lat:62.391085,lon:17.301332},F={x:731,y:1891,lat:62.390374,lon:17.307372},G={x:37,y:593,lat:62.389549,lon:17.300591},H={x:37,y:1891,lat:62.388898,lon:17.306525},I={x:1053,y:1891,lat:62.391066,lon:17.307737},J={x:1053,y:593,lat:62.391752,lon:17.301772};const K=100;for(var L=[[q,s],[u,v],[w,z],[A,B],[C,D],[E,F],[G,H],[H,I],[J,I],[G,J]],M=[],J=0;J<L.length;J++)for(var P,N=L[J][0],O=L[J][1],C=0;C<=K;C++)P={lat:lerp(N.lat,O.lat,C/K),lon:lerp(N.lon,O.lon,C/K),x:Math.round(lerp(N.x,O.x,C/K)),y:Math.round(lerp(N.y,O.y,C/K))},M.push(P);return M}$(function(){$("#startGame").click(function(){$("#register").hide(),noSleep.enable(),startGame()})});function startGame(){function q(){D(ca.renderer,ca.stage)}function u(da,ea,fa){return da*(1-fa)+ea*fa}function v(da,ea,fa,ga,ha){for(var ia=0;ia<ga;ia++){if(ha!==void 0&&0<ha.length&&ia===ha[0]){ha.shift();continue}dot=new aa(Z["assets/pacdot.png"].texture),dot.position.set(u(da,ea,ia/ga),fa),ca.stage.addChild(dot),L.push(dot)}}function w(da,ea,fa,ga,ha){for(var ia=0;ia<ga;ia++){if(ha!==void 0&&0<ha.length&&ia===ha[0]){ha.shift();continue}dot=new aa(Z["assets/pacdot.png"].texture),dot.position.set(fa,u(da,ea,ia/ga)),ca.stage.addChild(dot),L.push(dot)}}function z(){this.progress.toFixed(0)}function A(){let da=0.5;H=new aa(Z["assets/board.png"].texture),ca.stage.addChild(H),ca.stage.addChild(T),ca.stage.addChild(U),ca.stage.addChild(V),T.position.set(650,390),U.position.set(184,390),V.position.set((gameWidth-V.width)/2,480),v(60,1060,1600,25,[5,11,17]),v(60,1060,1273,25,[5,17]),v(60,1060,857,25,[5,11]),w(591,1920,265,35),w(591,1920,510,35,[18]),w(591,1920,728,35,[7]),I=new aa(Z["assets/pacman.png"].texture),I.position.set(-30,-30),I.vx=0,I.vy=0,I.anchor.set(0.5,0.5),ca.stage.addChild(I),geocache=new aa(Z["assets/geocache.png"].texture),geocache.position.set(850,1645),geocache.visible=!1,ca.stage.addChild(geocache),[{name:"blue",x:234,y:580,vy:da,vx:0},{name:"pink",x:700,y:880,vy:da,vx:0},{name:"yellow",x:480,y:1240,vy:0,vx:-da},{name:"red",x:20,y:1564,vy:0,vx:da}].forEach(function(fa){var ga=new aa(Z["assets/"+fa.name+"ghost.png"].texture);ga.position.set(fa.x,fa.y),ca.stage.addChild(ga),ga.data=fa,N.push(ga)}),M=L.length,J=new aa(Z["assets/gameover.png"].texture),J.position.set(350,900),J.visible=!1,ca.stage.addChild(J),K=new aa(Z["assets/winner.png"].texture),K.position.set((gameWidth-K.width)/2,800),K.visible=!1,ca.stage.addChild(K),ca.ticker.add(fa=>B(fa)),setInterval(function(){q()},2e3),W=new Date}function B(){L.forEach(function(ea){ea.visible&&C(ea,I)&&(ea.visible=!1,M--,S+=100,T.text=S,O.play())}),0===M&&(ca.ticker.stop(),geocache.visible=!0,K.visible=!0,$.post("saveresult.php",{username:$("#username").val(),timespent:X,score:S},function(ea){console.log(ea)})),N.forEach(function(ea){ea.x+=ea.data.vx,ea.y+=ea.data.vy,(20>ea.x||ea.x>gameWidth-(ea.width+20))&&(ea.data.vx=-ea.data.vx),(560>ea.y||ea.y>gameHeight-(ea.height+20))&&(ea.data.vy=-ea.data.vy)}),N.forEach(function(ea){!1===P.playing&&C(ea,I)&&(P.play(),ea.visible=!1,J.visible=!0,I.visible=!1,ca.ticker.stop())}),X=(Date.parse(new Date)-Date.parse(W))/1e3,U.text=("0"+Math.floor(X/60)).slice(-2)+":"+("0"+X%60).slice(-2)}function C(da,ea){let fa,ga,ha,ia,ja;return fa=!1,da.centerX=da.x+da.width/2-da.anchor.x*da.width,da.centerY=da.y+da.height/2-da.anchor.y*da.height,ea.centerX=ea.x+ea.width/2-ea.anchor.x*ea.width,ea.centerY=ea.y+ea.height/2-ea.anchor.y*ea.height,da.halfWidth=da.width/2,da.halfHeight=da.height/2,ea.halfWidth=ea.width/2,ea.halfHeight=ea.height/2,ia=da.centerX-ea.centerX,ja=da.centerY-ea.centerY,ga=da.halfWidth+ea.halfWidth,ha=da.halfHeight+ea.halfHeight,fa=!!(Math.abs(ia)<ga)&&!!(Math.abs(ja)<ha),fa}function D(da,ea){var fa=E(gameWidth,gameHeight,window.innerWidth,window.innerHeight);ea.scale.x=fa.width/gameWidth,ea.scale.y=fa.height/gameHeight,da.resize(fa.width,fa.height)}function E(da,ea,fa,ga){var ha=Math.min(fa/da,ga/ea);return{width:da*ha,height:ea*ha}}var H,I,J,K,M,L=[],N=[],O,P,Q;console.log($("#username").val());var W,X,S=0,T=new PIXI.Text("0",{fontFamily:"Courier",fontSize:80,fill:"white",fontWeight:"bold"}),U=new PIXI.Text("00:00",{fontFamily:"Courier",fontSize:80,fill:"white",fontWeight:"bold"}),V=new PIXI.Text($("#username").val(),{fontFamily:"Courier",fontSize:80,fill:"white",fontWeight:"bold"});let Y=PIXI.Application,Z=PIXI.loader.resources,_=PIXI.loader,aa=PIXI.Sprite,ba=calculateSnapGrid();navigator.geolocation?navigator.geolocation.watchPosition(function(da){for(var fa,ea=1e4,ga=0;ga<ba.length;ga++){var ha=ba[ga],ia=calculateDistance(ha.lat,ha.lon,da.coords.latitude,da.coords.longitude);ia<ea&&(fa=ha,ea=ia)}I.position.set(fa.x,fa.y),I.rotation=da.coords.heading.toRad()},function(da){alert("Error getting GPS position! You must open the link from your mobile browser, the GC-application won't work!\nError: "+da.message)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):alert("Sorry! Cannot access the GPS on your device");let ca=new Y({width:gameWidth,height:gameHeight});ca.renderer.autoResize=!0,document.body.appendChild(ca.view),window.addEventListener("resize",q),q();(function(){sounds.load(["assets/eat-pill.mp3","assets/eat-fruit.mp3","assets/eating.mp3","assets/ready.mp3","assets/siren.mp3","assets/die.mp3"]),sounds.whenLoaded=function(){},O=sounds["assets/eating.mp3"],Q=sounds["assets/siren.mp3"],P=sounds["assets/die.mp3"],_.add(["blueghost.png","cherry.png","pacdot.png","pinkghost.png","redghost.png","board.png","gameover.png","pacman.png","realmap.png","ready.png","yellowghost.png","geocache.png","winner.png"].map(fa=>"assets"+"/"+fa)).on("progress",z).load(A)})()}