const gameWidth=1080,gameHeight=1920;var gameStarted=!1,noSleep=new NoSleep;function calculateDistance(q,s,u,v){var z=(u-q).toRad(),A=(v-s).toRad(),B=Math.sin(z/2)*Math.sin(z/2)+Math.cos(q.toRad())*Math.cos(u.toRad())*Math.sin(A/2)*Math.sin(A/2),C=2*Math.atan2(Math.sqrt(B),Math.sqrt(1-B));return 6371000*C}Number.prototype.toRad=function(){return this*Math.PI/180};function lerp(q,s,u){return q*(1-u)+s*u}function calculateSnapGrid(){var q={x:37,y:861,lat:62.389415,lon:17.301815},s={x:1053,y:861,lat:62.391632,lon:17.302909},u={x:37,y:1279,lat:62.389211,lon:17.303724},v={x:1053,y:1279,lat:62.391394,lon:17.304851},w={x:37,y:1605,lat:62.389052,lon:17.305226},z={x:1053,y:1605,lat:62.39123,lon:17.306374},A={x:269,y:593,lat:62.390056,lon:17.30087},B={x:269,y:1891,lat:62.38945,lon:17.306793},C={x:514,y:593,lat:62.390573,lon:17.301106},D={x:514,y:1891,lat:62.389917,lon:17.307104},E={x:731,y:593,lat:62.391085,lon:17.301332},F={x:731,y:1891,lat:62.390374,lon:17.307372},G={x:37,y:593,lat:62.389549,lon:17.300591},H={x:37,y:1891,lat:62.388898,lon:17.306525},I={x:1053,y:1891,lat:62.391066,lon:17.307737},J={x:1053,y:593,lat:62.391752,lon:17.301772};const K=100;for(var L=[[q,s],[u,v],[w,z],[A,B],[C,D],[E,F],[G,H],[H,I],[J,I],[G,J]],M=[],J=0;J<L.length;J++)for(var P,N=L[J][0],O=L[J][1],C=0;C<=K;C++)P={lat:lerp(N.lat,O.lat,C/K),lon:lerp(N.lon,O.lon,C/K),x:Math.round(lerp(N.x,O.x,C/K)),y:Math.round(lerp(N.y,O.y,C/K))},M.push(P);return M}$(function(){$("#startGame").click(function(){$("#register").hide(),noSleep.enable(),startGame()})});function startGame(){function q(){D(ea.renderer,ea.stage)}function u(fa,ga,ha){return fa*(1-ha)+ga*ha}function v(fa,ga,ha,ia,ja){for(var ka=0;ka<ia;ka++){if(ja!==void 0&&0<ja.length&&ka===ja[0]){ja.shift();continue}dot=new ca(aa["assets/pacdot.png"].texture),dot.position.set(u(fa,ga,ka/ia),ha),ea.stage.addChild(dot),N.push(dot)}}function w(fa,ga,ha,ia,ja){for(var ka=0;ka<ia;ka++){if(ja!==void 0&&0<ja.length&&ka===ja[0]){ja.shift();continue}dot=new ca(aa["assets/pacdot.png"].texture),dot.position.set(ha,u(fa,ga,ka/ia)),ea.stage.addChild(dot),N.push(dot)}}function z(){this.progress.toFixed(0)}function A(){let fa=0.25;H=new ca(aa["assets/board.png"].texture),I=new ca(aa["assets/realmap.png"].texture),I.position.set(0,gameHeight-I.height),I.alpha=0,J=new ca(aa["assets/mapmarker.png"].texture),J.position.set((gameWidth-J.width)/2-20,300),J.interactive=!0,J.buttonMode=!0,J.on("pointerdown",function(){0<I.alpha?(console.log("Setting alpha 0"),I.alpha=0):(console.log("Setting alpha 0.6"),I.alpha=1)}),ea.stage.addChild(H),ea.stage.addChild(I),ea.stage.addChild(J),ea.stage.addChild(V),ea.stage.addChild(W),ea.stage.addChild(X),V.position.set(650,390),W.position.set(184,390),X.position.set((gameWidth-X.width)/2,480),v(60,1060,1600,25,[5,11,17]),v(60,1060,1273,25,[5,17]),v(60,1060,857,25,[5,11]),w(591,1920,265,35),w(591,1920,510,35,[18]),w(591,1920,728,35,[7]),K=new ca(aa["assets/pacman.png"].texture),K.position.set(-30,-30),K.vx=0,K.vy=0,K.anchor.set(0.5,0.5),ea.stage.addChild(K),geocache=new ca(aa["assets/geocache.png"].texture),geocache.position.set(850,1645),geocache.visible=!1,ea.stage.addChild(geocache),[{name:"blue",x:234,y:580,vy:fa,vx:0},{name:"pink",x:700,y:880,vy:fa,vx:0},{name:"yellow",x:480,y:1240,vy:0,vx:-fa},{name:"red",x:20,y:1564,vy:0,vx:fa}].forEach(function(ha){var ia=new ca(aa["assets/"+ha.name+"ghost.png"].texture);ia.position.set(ha.x,ha.y),ea.stage.addChild(ia),ia.data=ha,P.push(ia)}),O=N.length,L=new ca(aa["assets/gameover.png"].texture),L.position.set(350,900),L.visible=!1,ea.stage.addChild(L),M=new ca(aa["assets/winner.png"].texture),M.position.set((gameWidth-M.width)/2,800),M.visible=!1,ea.stage.addChild(M),ea.ticker.add(ha=>B(ha)),setInterval(function(){q()},2e3),Y=new Date}function B(){N.forEach(function(ga){ga.visible&&C(ga,K)&&(ga.visible=!1,O--,U+=100,V.text=U,Q.play())}),0===O&&(ea.ticker.stop(),geocache.visible=!0,M.visible=!0,$.post("saveresult.php",{username:$("#username").val(),timespent:Z,score:U},function(ga){console.log(ga)})),P.forEach(function(ga){ga.x+=ga.data.vx,ga.y+=ga.data.vy,(20>ga.x||ga.x>gameWidth-(ga.width+20))&&(ga.data.vx=-ga.data.vx),(560>ga.y||ga.y>gameHeight-(ga.height+20))&&(ga.data.vy=-ga.data.vy)}),P.forEach(function(ga){!1===S.playing&&C(ga,K)&&(S.play(),ga.visible=!1,L.visible=!0,K.visible=!1,ea.ticker.stop())}),Z=(Date.parse(new Date)-Date.parse(Y))/1e3,W.text=("0"+Math.floor(Z/60)).slice(-2)+":"+("0"+Z%60).slice(-2)}function C(fa,ga){let ha,ia,ja,ka,la;return ha=!1,fa.centerX=fa.x+fa.width/2-fa.anchor.x*fa.width,fa.centerY=fa.y+fa.height/2-fa.anchor.y*fa.height,ga.centerX=ga.x+ga.width/2-ga.anchor.x*ga.width,ga.centerY=ga.y+ga.height/2-ga.anchor.y*ga.height,fa.halfWidth=fa.width/2,fa.halfHeight=fa.height/2,ga.halfWidth=ga.width/2,ga.halfHeight=ga.height/2,ka=fa.centerX-ga.centerX,la=fa.centerY-ga.centerY,ia=fa.halfWidth+ga.halfWidth,ja=fa.halfHeight+ga.halfHeight,ha=!!(Math.abs(ka)<ia)&&!!(Math.abs(la)<ja),ha}function D(fa,ga){var ha=E(gameWidth,gameHeight,window.innerWidth,window.innerHeight);ga.scale.x=ha.width/gameWidth,ga.scale.y=ha.height/gameHeight,fa.resize(ha.width,ha.height)}function E(fa,ga,ha,ia){var ja=Math.min(ha/fa,ia/ga);return{width:fa*ja,height:ga*ja}}var H,I,J,K,L,M,O,N=[],P=[],Q,S,T;console.log($("#username").val());var Y,Z,U=0,V=new PIXI.Text("0",{fontFamily:"Courier",fontSize:80,fill:"white",fontWeight:"bold"}),W=new PIXI.Text("00:00",{fontFamily:"Courier",fontSize:80,fill:"white",fontWeight:"bold"}),X=new PIXI.Text($("#username").val(),{fontFamily:"Courier",fontSize:80,fill:"white",fontWeight:"bold"});let _=PIXI.Application,aa=PIXI.loader.resources,ba=PIXI.loader,ca=PIXI.Sprite,da=calculateSnapGrid();navigator.geolocation?navigator.geolocation.watchPosition(function(fa){for(var ha,ga=1e4,ia=0;ia<da.length;ia++){var ja=da[ia],ka=calculateDistance(ja.lat,ja.lon,fa.coords.latitude,fa.coords.longitude);ka<ga&&(ha=ja,ga=ka)}K.position.set(ha.x,ha.y),null!==fa.coords.heading&&(K.rotation=fa.coords.heading.toRad())},function(fa){alert("Error getting GPS position! You must open the link from your mobile browser, the GC-application won't work!\nError: "+fa.message)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):alert("Sorry! Cannot access the GPS on your device");let ea=new _({width:gameWidth,height:gameHeight});ea.renderer.autoResize=!0,document.body.appendChild(ea.view),window.addEventListener("resize",q),q();(function(){sounds.load(["assets/eat-pill.mp3","assets/eat-fruit.mp3","assets/eating.mp3","assets/ready.mp3","assets/siren.mp3","assets/die.mp3"]),sounds.whenLoaded=function(){},Q=sounds["assets/eating.mp3"],T=sounds["assets/siren.mp3"],S=sounds["assets/die.mp3"],ba.add(["blueghost.png","cherry.png","pacdot.png","pinkghost.png","redghost.png","board.png","mapmarker.png","gameover.png","pacman.png","realmap.png","ready.png","yellowghost.png","geocache.png","winner.png"].map(ha=>"assets"+"/"+ha)).on("progress",z).load(A)})()}